# 第17題.問卷管理

重點是需要多個JQ來執行增加欄位。

---

# 新增admin\_que.php

### 1. 修改後台的內容格式

主要保留fieldset的設計，並注意題目要求要透過JS來完成新增欄位。一樣傳送到api.php?do=addque。這裡稍微提到，因為是同一個table。所以必需要將POST看成兩筆，分別是父層級title及子層級text\[\]。

```php
<form action="api.php?do=addque" method="post">
<fieldset>
    <legend>新增問卷</legend>
    問卷名稱<input type="text" name="title"><br>
    <div id="option">
        <p>選項<input type="text" name="text[]"></p>
    </div>
    <input type="button" value="更多" onclick="addop()">
    <input type="submit" value="新增">
    <input type="reset" value="清空">
</fieldset>
</form>
<script>
function addop(){
    data='<p>選項<input type="text" name="text[]"></p>';
    $("#option").append(data);
}
</script>
```

# 增添api.php

因為是共用同一個form。所以新增時要分兩階段處理。

1. 先抽取出title到第一個陣列並丟到insert並取得ID。
2. 接著取得剛剛新增的ID。接著將剩下的POST進行分解成多筆慢慢送出新增

```php
case 'addque':
    print_r($_POST);
    $new['text']=$_POST['title'];
    $new['parent']=0;
    $id=insert($new,"t13_vote");
    foreach($_POST['text'] as $data){
        $myson['text']=$data;
        $myson['parent']=$id;
        insert($myson,"t13_vote");
    }
    plo("index.php");
break;
```



