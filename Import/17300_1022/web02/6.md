# 第6題. 登入登出

設計登入登出按鈕，相對應的驗證功能與查詢密碼與註冊。

---

# 新增login.php

### 1. 設計登入

示意圖上的眶線，是使用HTML的fieldset，大部分的版面示意都有出現，所以多背一下這個。

```
<fieldset>
    <legend>title</legend>
    content
</fieldset>
```

填入代碼，設計提交表單。重點在於解題要習慣所有表單都會到api.php，並夾帶動作要求\(do=login\)。由api裡處理。

```php
<fieldset>
<legend>會員登入</legend>
<form action="api.php?do=login" method="post">
<table>
    <tr><td>帳號：<input type="text" name="acc"></td></tr>
    <tr><td>密碼：<input type="password" name="pwd"></td></tr>
    <tr><td>
        <input type="submit" value="登入">
        <input type="reset" value="清除">
        <a href="?do=forget">忘記密碼</a>|<a href="?do=reg">尚未註冊</a>
    </td></tr>
</table>
</form>
</fieldset>
```

題目還有要求login.php兩個連結\(forget,register\)要做。這個在第九第十題才會開始配分設計

# 新增api.php

設計switch來做do=login的處理。題目要求有處理結果的提示\(使用JS.alert，並使用js轉址\)。如果可登入就給個session

```php
<?php
include "sql.php";
switch($_GET['do']){
    case 'login':
        $result=select("t6_user","acc='".$_POST['acc']."'");
        if($result==null) echo"<script>alert('查無帳號');".jlo("index.php?do=login").";</script>";
        $result=select("t6_user","acc='".$_POST['acc']."' and pwd='".$_POST['pwd']."'");
        if($result==null) echo"<script>alert('密碼錯誤');".jlo("index.php?do=login").";</script>";
        else{
            $_SESSION['user']=$_POST['acc'];
            plo("index.php");
        }
    break;
}
?>
```

---

# 增添sql.php

### 2. 登入登出按鈕

登入成功後，調整登入登出按鈕。這裡寫在sql.php可以減少對素材index.php的代碼複雜。

* 未登入顯示"&lt;a href='?do=login'&gt;會員登入&lt;/a&gt;"
* 已登入顯示"歡迎，".$\_SESSION\['user'\]."&lt;a href='?do=logout'&gt;登出&lt;/a&gt;"，登出在題目上有要求框線

```php
//t6
$t6userbtn=(empty($_SESSION['user']))?'<a href="?do=login">會員登入</a>':'歡迎，'.$_SESSION['user'].' <a style="border: solid 1px #000000" href="api.php?do=logout">登出</a>';
```

# 修改index.php

修改該對應位置

```php
<span style="width:18%; display:inline-block;"><a href="?do=login">會員登入</a></span>
```

為

```php
<span style="width:18%; display:inline-block;"><?=$t6userbtn?></span>
```

---

# 增添api.php

### 3. 登出

設計清除session並回到首頁

```php
case 'logout':
    unset($_SESSION['user']);
    plo("index.php");
break;
```



